#!/usr/bin/env bash

set -euo pipefail

# NOTE: Rename STANDARDS_BODY_TEMPLATE_ROOT to match your plugin
# (e.g., STANDARDS_BODY_OBSERVABILITY_ROOT)
if [[ -n "${STANDARDS_BODY_TEMPLATE_ROOT:-}" ]]; then
    REPO="$STANDARDS_BODY_TEMPLATE_ROOT"
elif [[ -n "${CLAUDE_PLUGIN_ROOT:-}" ]]; then
    REPO="$CLAUDE_PLUGIN_ROOT"
else
    REPO=$(git rev-parse --show-toplevel)
fi

FG_BLUE="\e[34m"
FG_RESET="\e[0m"

if [[ ! -d "${REPO}/node_modules" ]]; then
    echo -e "$FG_BLUE"
    echo -e "########################"
    echo -e "# Installing dependencies #"
    echo -e "########################"
    echo -e "$FG_RESET"

    cd "${REPO}"
    pnpm install
fi

cd "$REPO"

bun run apps/cli/src/run.ts "$@"
